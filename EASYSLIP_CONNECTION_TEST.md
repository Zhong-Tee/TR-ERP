# р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н EasySlip API

## р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З

### 1. тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Error Message

**р╕Бр╣Ир╕нр╕Щ:**
```
р╕Бр╕▓р╕гр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Хр╕▒р╕зр╕Хр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з (HTTP 401): Invalid JWT

р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:
1. р╕зр╣Ир╕▓р╕Др╕╕р╕Ур╕вр╕▒р╕Зр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕нр╕вр╕╣р╣Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И
2. Session token р╕вр╕▒р╕Зр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
3. Edge Function permissions
```

**р╕лр╕ер╕▒р╕З:**
```
р╕Бр╕▓р╕гр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Хр╕▒р╕зр╕Хр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з (HTTP 401)

р╕кр╕▓р╣Ар╕лр╕Хр╕╕: Invalid JWT

р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕В:
1. р╕ер╕нр╕Зр╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ър╣Бр╕ер╕░р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Гр╕лр╕бр╣И
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Session token р╕вр╕▒р╕Зр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Й (р╣Др╕бр╣Ир╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕)
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Edge Function р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Secrets р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╣Йр╕з
   - EASYSLIP_API_KEY
   - SERVICE_ROLE_KEY
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Logs р╣Гр╕Щ Supabase Dashboard тЖТ Edge Functions тЖТ verify-slip тЖТ Logs
```

### 2. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н

**р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Гр╕лр╕бр╣И:** `testEasySlipConnection()`

**р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:**
- тЬЕ Edge Function р╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
- тЬЕ Secrets р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И (EASYSLIP_API_KEY, SERVICE_ROLE_KEY)
- тЬЕ EasySlip API р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

### 3. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Ыр╕╕р╣Ир╕бр╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щр╕лр╕Щр╣Йр╕▓ Settings

**р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З:** р╕лр╕Щр╣Йр╕▓ Settings тЖТ р╕Фр╣Йр╕▓р╕Щр╕Ър╕Щ (р╕Бр╣Ир╕нр╕Щ Tabs)

**р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М:**
- р╕Ыр╕╕р╣Ир╕б "р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н EasySlip API"
- р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Бр╕Ър╕Ър╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
- р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╣Бр╕Хр╣Ир╕ер╕░р╕кр╣Ир╕зр╕Щ (Edge Function, Secrets, EasySlip API)

---

## р╕зр╕┤р╕Шр╕╡р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### 1. р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ Settings

1. **р╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ Settings:**
   - р╣Др╕Ыр╕Чр╕╡р╣Ир╣Ар╕бр╕Щр╕╣ "р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓" р╣Гр╕Щр╣Бр╕нр╕Ыр╕Юр╕ер╕┤р╣Ар╕Др╕Кр╕▒р╕Щ

2. **р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕б "р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н EasySlip API":**
   - р╕нр╕вр╕╣р╣Ир╕Фр╣Йр╕▓р╕Щр╕Ър╕Щр╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓ Settings
   - р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣Ир╣Гр╕лр╣Йр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕кр╕гр╣Зр╕И

3. **р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М:**
   - тЬЕ **р╕кр╕│р╣Ар╕гр╣Зр╕И:** р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з
   - тЭМ **р╕ер╣Йр╕бр╣Ар╕лр╕ер╕з:** р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Чр╕╡р╣Ир╕ер╣Йр╕бр╣Ар╕лр╕ер╕зр╣Бр╕ер╕░р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕В

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

**р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ:**

```
тЬЕ р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н EasySlip API р╕кр╕│р╣Ар╕гр╣Зр╕И

Edge Function: тЬЕ р╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Й
Secrets р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Бр╕ер╣Йр╕з: тЬЕ р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Бр╕ер╣Йр╕з
EasySlip API: тЬЕ р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Др╕Фр╣Й
```

**р╕Цр╣Йр╕▓р╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓:**

```
тЭМ р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓:
- Edge Function р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Й
- Secrets р╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ (EASYSLIP_API_KEY, SERVICE_ROLE_KEY)
- EasySlip API р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Й

Error: [р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф error]
```

---

## Deploy Edge Function р╣Гр╕лр╕бр╣И

**р╕Хр╣Йр╕нр╕З Deploy Edge Function р╣Гр╕лр╕бр╣Ир╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕гр╕нр╕Зр╕гр╕▒р╕Ъ method 'test':**

```powershell
cd e:\Web_App\TR-ERP
supabase functions deploy verify-slip
```

---

## Checklist

### р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З:
- [x] р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Error Message р╣Гр╕лр╣Йр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щр╕Вр╕╢р╣Йр╕Щ
- [x] р╣Ар╕Юр╕┤р╣Ир╕бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ `testEasySlipConnection()`
- [x] р╣Ар╕Юр╕┤р╣Ир╕бр╕Ыр╕╕р╣Ир╕бр╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щр╕лр╕Щр╣Йр╕▓ Settings
- [x] р╣Ар╕Юр╕┤р╣Ир╕б handler р╕кр╕│р╕лр╕гр╕▒р╕Ъ method 'test' р╣Гр╕Щ Edge Function
- [ ] Deploy Edge Function р╣Гр╕лр╕бр╣И

### р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ:
- [ ] Deploy Edge Function р╣Гр╕лр╕бр╣И
- [ ] р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ Settings
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
- [ ] р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕ер╕┤р╕Ыр╕Ир╕гр╕┤р╕З

---

## Troubleshooting

### р╕Ыр╕▒р╕Нр╕лр╕▓: р╕Ыр╕╕р╣Ир╕бр╕Чр╕Фр╕кр╕нр╕Ър╣Др╕бр╣Ир╕Чр╕│р╕Зр╕▓р╕Щ

**р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:**
1. Edge Function Deploy р╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
2. р╕бр╕╡ error р╣Гр╕Щ console р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
3. Session token р╕вр╕▒р╕Зр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
- Deploy Edge Function р╣Гр╕лр╕бр╣И
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ console logs
- р╕ер╕нр╕З logout р╣Бр╕ер╕░ login р╣Гр╕лр╕бр╣И

### р╕Ыр╕▒р╕Нр╕лр╕▓: р╣Бр╕кр╕Фр╕З "Secrets р╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓"

**р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:**
1. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Secrets р╣Гр╕Щ Supabase Dashboard р╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
2. Secrets р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
- р╣Др╕Ыр╕Чр╕╡р╣И Supabase Dashboard тЖТ Settings тЖТ Edge Functions тЖТ Secrets
- р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ `EASYSLIP_API_KEY` р╣Бр╕ер╕░ `SERVICE_ROLE_KEY`
- Deploy Edge Function р╣Гр╕лр╕бр╣И

### р╕Ыр╕▒р╕Нр╕лр╕▓: р╣Бр╕кр╕Фр╕З "EasySlip API р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Др╕Фр╣Й"

**р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:**
1. `EASYSLIP_API_KEY` р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
2. EasySlip service р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `EASYSLIP_API_KEY` р╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ EasySlip service р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з
- р╕Фр╕╣ Logs р╣Гр╕Щ Supabase Dashboard

---

## р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕

тЬЕ **р╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з:**
- р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Error Message р╣Бр╕ер╣Йр╕з
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╣Бр╕ер╣Йр╕з
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Ыр╕╕р╣Ир╕бр╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щр╕лр╕Щр╣Йр╕▓ Settings р╣Бр╕ер╣Йр╕з

ЁЯУЭ **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕нр╣Др╕Ы:**
1. Deploy Edge Function р╣Гр╕лр╕бр╣И
2. р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ Settings
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
4. р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕ер╕┤р╕Ыр╕Ир╕гр╕┤р╕З
